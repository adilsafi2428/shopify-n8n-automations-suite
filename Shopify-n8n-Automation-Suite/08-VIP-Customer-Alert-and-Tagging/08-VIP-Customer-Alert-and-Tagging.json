{
  "name": "08-VIP-Customer-Alert-and-Tagging",
  "nodes": [
    {
      "parameters": {
        "authentication": "accessToken",
        "topic": "orders/create"
      },
      "type": "n8n-nodes-base.shopifyTrigger",
      "typeVersion": 1,
      "position": [
        -240,
        1184
      ],
      "id": "c55a2a23-d352-4749-995c-1479b308becc",
      "name": "Shopify: On New Order1",
      "webhookId": "315afae7-e15e-4718-8ecf-d22637b1e290"
    },
    {
      "parameters": {
        "content": "#  8. VIP Customer alert\n-->Your workflow now has a professional \"V-shape\" structure:\n\nTop Branch (Loyalist): Automatically updates Shopify Tags to keep the database organized.\n\nMiddle Branch (Big Spender): Sends a high-end Gmail alert for immediate sales attention.\n\nBottom Branch (Frequent): (Can be connected to another Gmail or a log file later).",
        "height": 432,
        "width": 1216
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -368,
        976
      ],
      "typeVersion": 1,
      "id": "bd802c30-55e1-4676-ab49-18e156216bc6",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "url": "=https://adil-safikhan.myshopify.com/admin/api/2024-01/customers/{{ $node[\"Shopify: On New Order\"].json[\"customer\"][\"id\"] }}.json",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-Shopify-Access-Token",
              "value": "\"ADMIN API KEY\""
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -16,
        1184
      ],
      "id": "ab4e9349-3564-40a0-a6c2-6eac056354a9",
      "name": "Get Full Customer"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "60f705e9-9801-4698-a342-52ec2257c63d",
              "name": "current_val",
              "value": "={{ $node[\"Shopify: On New Order\"].json[\"total_price\"] }}",
              "type": "number"
            },
            {
              "id": "9cfe5c00-26db-4c06-8839-5c8671e73caa",
              "name": "orders_count",
              "value": "={{ $json[\"customer\"][\"orders_count\"] }}",
              "type": "number"
            },
            {
              "id": "fc62d3d1-7db3-4cdb-91b6-9794d4c82c9d",
              "name": "total_spent",
              "value": "={{ $json[\"customer\"][\"total_spent\"] }}",
              "type": "number"
            },
            {
              "id": "d09cb5ea-5331-4815-8b91-d061962e9bcb",
              "name": "retuns_count",
              "value": "={{ $json.customer.tags }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        208,
        1184
      ],
      "id": "0e5eb88c-55e7-4642-8ad3-a4a6b7a1e592",
      "name": "VIP Segment Prep"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "28a113dd-2319-4916-b5ee-6d5add041599",
                    "leftValue": "={{ $json.total_spent >= 15000 }}",
                    "rightValue": 15000,
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Loyalist"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "27c87664-6009-486c-829d-f458f8bb8614",
                    "leftValue": "={{ $json.current_val >= 5000 }}",
                    "rightValue": "={{ $json.orders_count }}",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Big Spender"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "7d3a6186-16c8-49bc-bffe-fa92699b2b84",
                    "leftValue": "={{ $json.orders_count >=10 }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Frequent"
            }
          ]
        },
        "options": {
          "fallbackOutput": "none"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        432,
        1152
      ],
      "id": "dd516a57-85e7-4338-b8f8-3563f2923c3e",
      "name": "VIP Branching Brain"
    },
    {
      "parameters": {
        "authentication": "accessToken",
        "operation": "update",
        "orderId": "={{ $node[\"Shopify: On New Order\"].json[\"id\"] }}",
        "updateFields": {
          "tags": "={{ $node[\"Shopify: On New Order\"].json[\"tags\"] }}, VIP-LOYALIST, LTV-HIGH"
        }
      },
      "type": "n8n-nodes-base.shopify",
      "typeVersion": 1,
      "position": [
        656,
        1072
      ],
      "id": "ebcea32a-cd3d-4e3e-8cf4-bb8e3c28d96d",
      "name": "Auto-Tag Loyalist"
    },
    {
      "parameters": {
        "sendTo": "adilsafi2828@gmail.com",
        "subject": "=‚≠ê GOLD ORDER ALERT: {{ $node[\"Get Full Customer\"].json.customer.first_name  }} ({{ $node[\"Shopify: On New Order\"].json.total_price }} PKR)",
        "message": "=<div style=\"font-family: Arial, sans-serif; border: 2px solid #D4AF37; border-radius: 10px; padding: 20px; max-width: 500px;\">   <h2 style=\"color: #D4AF37; margin-top: 0;\">üèÜ High-Value Order Detected</h2>   <p>Master, a <strong>Big Spender</strong> has just placed an order!</p>   <hr style=\"border: 0; border-top: 1px solid #eee;\">   <p><strong>Customer:</strong> {{ $node[\"Get Full Customer\"].json.customer.first_name }} {{ $node[\"Get Full Customer\"].json.customer.last_name }}</p>   <p><strong>Order Total:</strong> {{ $node[\"Shopify: On New Order\"].json.total_price }} {{ $node[\"Shopify: On New Order\"].json.currency }}</p>   <p><strong>Order Number:</strong> #{{ $node[\"Shopify: On New Order\"].json.order_number }}</p>   <hr style=\"border: 0; border-top: 1px solid #eee;\">   <p style=\"font-style: italic; color: #666;\">Note: This customer spent over 5,000 PKR in a single transaction. Recommend adding a free gift or premium packaging.</p>   <div style=\"text-align: center; margin-top: 20px;\">     <a href=\"https://admin.shopify.com/store/adil-safikhan/orders/{{ $node[\"Shopify: On New Order\"].json.id }}\"         style=\"background-color: #D4AF37; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; font-weight: bold;\">        View Order in Shopify     </a>   </div> </div>",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        656,
        1264
      ],
      "id": "3e24424e-f06d-4dcb-974c-11cb236b16ba",
      "name": "Send Gold Alert",
      "webhookId": "6f15a845-0906-41e1-8097-ba6e4f20d487"
    }
  ],
  "pinData": {
    "Shopify: On New Order1": [
      {
        "json": {
          "id": 5722606600344,
          "admin_graphql_api_id": "gid://shopify/Order/5722606600344",
          "app_id": 580111,
          "browser_ip": "2404:3100:104b:4aa6:b5f6:7848:cc46:2532",
          "buyer_accepts_marketing": false,
          "cancel_reason": null,
          "cancelled_at": null,
          "cart_token": "hWN6iMxcaAKft6kh2pJVA5KL",
          "checkout_id": 32085335015576,
          "checkout_token": "5be4b6d7bcaaeed8c8b446806f90e1b1",
          "client_details": {
            "accept_language": "en-PK",
            "browser_height": null,
            "browser_ip": "2404:3100:104b:4aa6:b5f6:7848:cc46:2532",
            "browser_width": null,
            "session_hash": null,
            "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36"
          },
          "closed_at": null,
          "company": null,
          "confirmation_number": "5I0QVPXZD",
          "confirmed": true,
          "contact_email": "adildawood2143@gmail.com",
          "created_at": "2025-12-22T01:08:54-05:00",
          "currency": "PKR",
          "current_shipping_price_set": {
            "shop_money": {
              "amount": "0.00",
              "currency_code": "PKR"
            },
            "presentment_money": {
              "amount": "0.00",
              "currency_code": "PKR"
            }
          },
          "current_subtotal_price": "2999.00",
          "current_subtotal_price_set": {
            "shop_money": {
              "amount": "2999.00",
              "currency_code": "PKR"
            },
            "presentment_money": {
              "amount": "2999.00",
              "currency_code": "PKR"
            }
          },
          "current_total_additional_fees_set": null,
          "current_total_discounts": "0.00",
          "current_total_discounts_set": {
            "shop_money": {
              "amount": "0.00",
              "currency_code": "PKR"
            },
            "presentment_money": {
              "amount": "0.00",
              "currency_code": "PKR"
            }
          },
          "current_total_duties_set": null,
          "current_total_price": "2999.00",
          "current_total_price_set": {
            "shop_money": {
              "amount": "2999.00",
              "currency_code": "PKR"
            },
            "presentment_money": {
              "amount": "2999.00",
              "currency_code": "PKR"
            }
          },
          "current_total_tax": "0.00",
          "current_total_tax_set": {
            "shop_money": {
              "amount": "0.00",
              "currency_code": "PKR"
            },
            "presentment_money": {
              "amount": "0.00",
              "currency_code": "PKR"
            }
          },
          "customer_locale": "en-PK",
          "device_id": null,
          "discount_codes": [],
          "duties_included": false,
          "email": "adildawood2143@gmail.com",
          "estimated_taxes": false,
          "financial_status": "paid",
          "fulfillment_status": null,
          "landing_site": "/password",
          "landing_site_ref": null,
          "location_id": null,
          "merchant_business_entity_id": "32381567128",
          "merchant_of_record_app_id": null,
          "name": "#1024",
          "note": null,
          "note_attributes": [],
          "number": 24,
          "order_number": 1024,
          "order_status_url": "https://adil-safikhan.myshopify.com/73819783320/orders/68b6fb9ab7178c4569efa97a8281c9a9/authenticate?key=32e202b98017edc394346e296c12ed20",
          "original_total_additional_fees_set": null,
          "original_total_duties_set": null,
          "payment_gateway_names": [
            "bogus"
          ],
          "phone": null,
          "po_number": null,
          "presentment_currency": "PKR",
          "processed_at": "2025-12-22T01:08:51-05:00",
          "reference": null,
          "referring_site": null,
          "source_identifier": null,
          "source_name": "web",
          "source_url": null,
          "subtotal_price": "2999.00",
          "subtotal_price_set": {
            "shop_money": {
              "amount": "2999.00",
              "currency_code": "PKR"
            },
            "presentment_money": {
              "amount": "2999.00",
              "currency_code": "PKR"
            }
          },
          "tags": "",
          "tax_exempt": false,
          "tax_lines": [],
          "taxes_included": false,
          "test": true,
          "token": "68b6fb9ab7178c4569efa97a8281c9a9",
          "total_cash_rounding_payment_adjustment_set": {
            "shop_money": {
              "amount": "0.00",
              "currency_code": "PKR"
            },
            "presentment_money": {
              "amount": "0.00",
              "currency_code": "PKR"
            }
          },
          "total_cash_rounding_refund_adjustment_set": {
            "shop_money": {
              "amount": "0.00",
              "currency_code": "PKR"
            },
            "presentment_money": {
              "amount": "0.00",
              "currency_code": "PKR"
            }
          },
          "total_discounts": "0.00",
          "total_discounts_set": {
            "shop_money": {
              "amount": "0.00",
              "currency_code": "PKR"
            },
            "presentment_money": {
              "amount": "0.00",
              "currency_code": "PKR"
            }
          },
          "total_line_items_price": "2999.00",
          "total_line_items_price_set": {
            "shop_money": {
              "amount": "2999.00",
              "currency_code": "PKR"
            },
            "presentment_money": {
              "amount": "2999.00",
              "currency_code": "PKR"
            }
          },
          "total_outstanding": "0.00",
          "total_price": "2999.00",
          "total_price_set": {
            "shop_money": {
              "amount": "2999.00",
              "currency_code": "PKR"
            },
            "presentment_money": {
              "amount": "2999.00",
              "currency_code": "PKR"
            }
          },
          "total_shipping_price_set": {
            "shop_money": {
              "amount": "0.00",
              "currency_code": "PKR"
            },
            "presentment_money": {
              "amount": "0.00",
              "currency_code": "PKR"
            }
          },
          "total_tax": "0.00",
          "total_tax_set": {
            "shop_money": {
              "amount": "0.00",
              "currency_code": "PKR"
            },
            "presentment_money": {
              "amount": "0.00",
              "currency_code": "PKR"
            }
          },
          "total_tip_received": "0.00",
          "total_weight": 0,
          "updated_at": "2025-12-22T01:08:55-05:00",
          "user_id": null,
          "billing_address": {
            "first_name": "Abas",
            "address1": "Peshawar, Khyber pekhtonkhwa, Pakistan",
            "phone": "+923359331586",
            "city": "Landi kotal",
            "zip": "24470",
            "province": null,
            "country": "Pakistan",
            "last_name": "Khan",
            "address2": null,
            "company": null,
            "latitude": 34.00833739999999,
            "longitude": 71.5188619,
            "name": "Abas Khan",
            "country_code": "PK",
            "province_code": null
          },
          "customer": {
            "id": 8414097342616,
            "created_at": "2025-11-16T01:43:43-05:00",
            "updated_at": "2025-12-22T01:08:54-05:00",
            "first_name": "Adil",
            "last_name": "Safi",
            "state": "disabled",
            "note": "",
            "verified_email": true,
            "multipass_identifier": null,
            "tax_exempt": false,
            "email": "adildawood2143@gmail.com",
            "phone": null,
            "currency": "PKR",
            "tax_exemptions": [],
            "admin_graphql_api_id": "gid://shopify/Customer/8414097342616",
            "default_address": {
              "id": 9698956574872,
              "customer_id": 8414097342616,
              "first_name": "Abas",
              "last_name": "Khan",
              "company": null,
              "address1": "Peshawar, Khyber pekhtonkhwa, Pakistan",
              "address2": null,
              "city": "Landi kotal",
              "province": null,
              "country": "Pakistan",
              "zip": "24470",
              "phone": "+923359331586",
              "name": "Abas Khan",
              "province_code": null,
              "country_code": "PK",
              "country_name": "Pakistan",
              "default": true
            }
          },
          "discount_applications": [],
          "fulfillments": [],
          "line_items": [
            {
              "id": 13823068373144,
              "admin_graphql_api_id": "gid://shopify/LineItem/13823068373144",
              "attributed_staffs": [],
              "current_quantity": 1,
              "fulfillable_quantity": 1,
              "fulfillment_service": "manual",
              "fulfillment_status": null,
              "gift_card": false,
              "grams": 0,
              "name": "High-Speed USB-C Power Adapter and Charging Cable Set - White",
              "price": "2999.00",
              "price_set": {
                "shop_money": {
                  "amount": "2999.00",
                  "currency_code": "PKR"
                },
                "presentment_money": {
                  "amount": "2999.00",
                  "currency_code": "PKR"
                }
              },
              "product_exists": true,
              "product_id": 8895311708312,
              "properties": [],
              "quantity": 1,
              "requires_shipping": true,
              "sales_line_item_group_id": null,
              "sku": "CH-CGR-WHT-001",
              "taxable": false,
              "title": "High-Speed USB-C Power Adapter and Charging Cable Set",
              "total_discount": "0.00",
              "total_discount_set": {
                "shop_money": {
                  "amount": "0.00",
                  "currency_code": "PKR"
                },
                "presentment_money": {
                  "amount": "0.00",
                  "currency_code": "PKR"
                }
              },
              "variant_id": 47472529309848,
              "variant_inventory_management": "shopify",
              "variant_title": "White",
              "vendor": "Adil_Safikhan",
              "tax_lines": [
                {
                  "channel_liable": false,
                  "price": "0.00",
                  "price_set": {
                    "shop_money": {
                      "amount": "0.00",
                      "currency_code": "PKR"
                    },
                    "presentment_money": {
                      "amount": "0.00",
                      "currency_code": "PKR"
                    }
                  },
                  "rate": 0.16,
                  "title": "GST"
                }
              ],
              "duties": [],
              "discount_allocations": []
            }
          ],
          "payment_terms": null,
          "refunds": [],
          "shipping_address": {
            "first_name": "Abas",
            "address1": "Peshawar, Khyber pekhtonkhwa, Pakistan",
            "phone": "+923359331586",
            "city": "Landi kotal",
            "zip": "24470",
            "province": null,
            "country": "Pakistan",
            "last_name": "Khan",
            "address2": null,
            "company": null,
            "latitude": 34.00833739999999,
            "longitude": 71.5188619,
            "name": "Abas Khan",
            "country_code": "PK",
            "province_code": null
          },
          "shipping_lines": [
            {
              "id": 4713730867352,
              "carrier_identifier": null,
              "code": "Standard",
              "current_discounted_price_set": {
                "shop_money": {
                  "amount": "0.00",
                  "currency_code": "PKR"
                },
                "presentment_money": {
                  "amount": "0.00",
                  "currency_code": "PKR"
                }
              },
              "discounted_price": "0.00",
              "discounted_price_set": {
                "shop_money": {
                  "amount": "0.00",
                  "currency_code": "PKR"
                },
                "presentment_money": {
                  "amount": "0.00",
                  "currency_code": "PKR"
                }
              },
              "is_removed": false,
              "phone": null,
              "price": "0.00",
              "price_set": {
                "shop_money": {
                  "amount": "0.00",
                  "currency_code": "PKR"
                },
                "presentment_money": {
                  "amount": "0.00",
                  "currency_code": "PKR"
                }
              },
              "requested_fulfillment_service_id": null,
              "source": "shopify",
              "title": "Standard",
              "tax_lines": [],
              "discount_allocations": []
            }
          ],
          "returns": [],
          "line_item_groups": []
        }
      }
    ]
  },
  "connections": {
    "Shopify: On New Order1": {
      "main": [
        [
          {
            "node": "Get Full Customer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Full Customer": {
      "main": [
        [
          {
            "node": "VIP Segment Prep",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "VIP Segment Prep": {
      "main": [
        [
          {
            "node": "VIP Branching Brain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "VIP Branching Brain": {
      "main": [
        [
          {
            "node": "Auto-Tag Loyalist",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Gold Alert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "e6011742-0c97-40ae-a7f1-6dd6d3bd0e2c",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "8b146e869da925f8999d33c052e74d2c62b483c7917680c58792ad7c67fd6a63"
  },
  "id": "ilPmkuTGK9MefwXl",
  "tags": []
}